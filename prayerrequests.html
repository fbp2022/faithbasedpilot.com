<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Prayer Requests ¬∑ The Forge</title>
  <meta name="color-scheme" content="dark light" />
  <meta name="description" content="Submit and view prayer requests within The Forge men's community." />

  <style>
    /* ================== BASE / THEME (copied from theforge.html) ================== */
    :root {
      --bg-main: #05070f;
      --bg-elevated: rgba(10, 14, 30, 0.95);
      --bg-card: rgba(9, 14, 32, 0.95);
      --bg-card-soft: rgba(18, 24, 48, 0.9);
      --bg-deep: #000000;

      --bg-header-strong: rgba(0, 0, 0, 0.9);
      --bg-header-soft: rgba(0, 0, 0, 0.7);
      --bg-mobile-overlay: rgba(2, 4, 10, 0.97);

      --border-subtle: rgba(0, 255, 200, 0.25);
      --accent: #00ffd0;
      --accent-soft: rgba(0, 255, 200, 0.5);
      --accent-alt: #00aaff;

      --text-main: #e3f6ff;
      --text-muted: #a6bfdc;
      --text-soft: #7e91b8;
      --danger: #ff4b4b;

      --shadow-strong: 0 0 35px rgba(0, 0, 0, 0.9);
      --shadow-accent: 0 0 24px rgba(0, 255, 200, 0.45);

      --nav-height: 64px;
      --radius-lg: 18px;
      --radius-md: 12px;
      --radius-full: 999px;
      --transition-fast: 0.18s ease;
      --transition-med: 0.25s ease;
    }

    :root[data-theme="light"] {
      --bg-main: #f5f7fb;
      --bg-elevated: rgba(255, 255, 255, 0.98);
      --bg-card: rgba(255, 255, 255, 0.98);
      --bg-card-soft: rgba(245, 247, 252, 0.98);
      --bg-deep: #c7d2fe;

      --bg-header-strong: rgba(255, 255, 255, 0.98);
      --bg-header-soft: rgba(248, 250, 252, 0.9);
      --bg-mobile-overlay: rgba(245, 247, 252, 0.98);

      --border-subtle: rgba(0, 140, 255, 0.25);
      --accent: #0074ff;
      --accent-soft: rgba(0, 116, 255, 0.5);
      --accent-alt: #00b8ff;

      --text-main: #071420;
      --text-muted: #4f5c77;
      --text-soft: #7a8799;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html,
    body {
      height: 100%;
      scroll-behavior: smooth;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(
        circle at 0% 0%,
        var(--bg-card-soft) 0,
        var(--bg-main) 40%,
        var(--bg-deep) 100%
      );
      color: var(--text-main);
      -webkit-font-smoothing: antialiased;
    }

    /* Ambient animated background */
    .ambient-orbit {
      position: fixed;
      inset: -40%;
      pointer-events: none;
      z-index: -1;
      background:
        radial-gradient(circle at 10% 0, rgba(0, 255, 200, 0.16), transparent 55%),
        radial-gradient(circle at 100% 100%, rgba(0, 140, 255, 0.18), transparent 60%);
      opacity: 0.75;
      animation: orbit 30s linear infinite alternate;
      mix-blend-mode: screen;
    }

    @keyframes orbit {
      0% {
        transform: translate3d(0, 0, 0) scale(1);
      }
      50% {
        transform: translate3d(-3%, 4%, 0) scale(1.05);
      }
      100% {
        transform: translate3d(3%, -4%, 0) scale(1.02);
      }
    }

    .shell {
      max-width: 1120px;
      margin: 0 auto;
      padding: 0 1.5rem 3.5rem;
    }

    /* ================== HEADER / NAV (copied) ================== */

    header {
      position: sticky;
      top: 0;
      z-index: 40;
      backdrop-filter: blur(16px);
      background: linear-gradient(
        to bottom,
        var(--bg-header-strong),
        var(--bg-header-soft),
        transparent
      );
      border-bottom: 1px solid var(--border-subtle);
    }

    .nav {
      display: flex;
      align-items: center;
      justify-content: space-between;
      height: var(--nav-height);
      max-width: 1120px;
      margin: 0 auto;
      padding: 0 1.5rem;
      gap: 1.5rem;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      white-space: nowrap;
    }

    .brand-logo {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      border: 1px solid var(--border-subtle);
      box-shadow: var(--shadow-accent);
      object-fit: cover;
      background: #020409;
    }

    .brand-text-main {
      font-size: 1rem;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      font-weight: 600;
      color: var(--text-main);
    }

    .nav-links {
      display: flex;
      align-items: center;
      gap: 1rem;
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.14em;
    }

    .nav-links a {
      text-decoration: none;
      color: var(--text-muted);
      position: relative;
      padding-bottom: 0.15rem;
      cursor: pointer;
      transition: color var(--transition-fast);
    }

    .nav-links a::after {
      content: "";
      position: absolute;
      left: 0;
      bottom: 0;
      width: 0;
      height: 2px;
      border-radius: 999px;
      background: linear-gradient(90deg, var(--accent), var(--accent-alt));
      transition: width var(--transition-fast);
    }

    .nav-links a:hover {
      color: var(--text-main);
    }

    .nav-links a:hover::after {
      width: 100%;
    }

    /* Simple active link state for Prayer Requests */
    .nav-links a.active {
      color: var(--accent);
    }
    .nav-links a.active::after {
      width: 100%;
    }

    .nav-actions {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .theme-toggle {
      border-radius: var(--radius-full);
      border: 1px solid var(--border-subtle);
      padding: 0.35rem 0.9rem;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      background: var(--bg-elevated);
      color: var(--text-muted);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      transition:
        background var(--transition-fast),
        border-color var(--transition-fast),
        transform var(--transition-fast),
        box-shadow var(--transition-fast),
        color var(--transition-fast);
    }

    .theme-toggle:hover {
      transform: translateY(-1px);
      box-shadow: 0 0 15px rgba(0, 255, 200, 0.3);
      border-color: var(--accent-soft);
      color: var(--text-main);
    }

    .theme-toggle span {
      font-size: 0.9rem;
    }

    .hamburger {
      display: none;
      width: 40px;
      height: 34px;
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      background: var(--bg-elevated);
      cursor: pointer;
      align-items: center;
      justify-content: center;
      gap: 4px;
      flex-direction: column;
      padding: 6px 0;
      transition:
        background var(--transition-fast),
        box-shadow var(--transition-fast),
        transform var(--transition-fast);
    }

    .hamburger-line {
      width: 18px;
      height: 2px;
      border-radius: 999px;
      background: var(--text-muted);
      transition:
        transform var(--transition-fast),
        opacity var(--transition-fast),
        background var(--transition-fast);
    }

    .hamburger:hover {
      background: var(--bg-card-soft);
      box-shadow: 0 0 15px rgba(0, 255, 200, 0.35);
      transform: translateY(-1px);
    }

    .hamburger.is-open .hamburger-line:nth-child(1) {
      transform: translateY(4px) rotate(45deg);
      background: var(--accent);
    }

    .hamburger.is-open .hamburger-line:nth-child(2) {
      opacity: 0;
    }

    .hamburger.is-open .hamburger-line:nth-child(3) {
      transform: translateY(-4px) rotate(-45deg);
      background: var(--accent);
    }

    .mobile-nav {
      display: none;
      position: fixed;
      inset: var(--nav-height) 0 0 0;
      background:
        radial-gradient(circle at 0 0, rgba(0, 255, 200, 0.16), transparent 60%),
        radial-gradient(circle at 100% 100%, rgba(0, 140, 255, 0.18), transparent 60%),
        var(--bg-mobile-overlay);
      backdrop-filter: blur(20px);
      z-index: 35;
    }

    .mobile-nav.open {
      display: block;
    }

    .mobile-nav-inner {
      max-width: 1120px;
      margin: 0 auto;
      padding: 1.25rem 1.5rem 2rem;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .mobile-nav-inner a {
      text-decoration: none;
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: var(--text-muted);
      padding: 0.6rem 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.06);
      cursor: pointer;
      transition: color var(--transition-fast), border-color var(--transition-fast);
    }

    .mobile-nav-inner a:last-child {
      border-bottom: none;
    }

    .mobile-nav-inner a:hover {
      color: var(--accent);
      border-color: rgba(0, 255, 200, 0.5);
    }

    @media (max-width: 840px) {
      .nav-links {
        display: none;
      }

      .hamburger {
        display: flex;
      }
    }

    main {
      padding-top: 1.5rem;
    }

    footer {
      margin-top: 2rem;
      padding-top: 1.5rem;
      border-top: 1px solid rgba(255, 255, 255, 0.05);
      font-size: 0.8rem;
      color: var(--text-soft);
      display: flex;
      justify-content: space-between;
      gap: 0.75rem;
      flex-wrap: wrap;
    }

    @media (max-width: 600px) {
      .shell {
        padding: 0 1.1rem 3rem;
      }

      .nav {
        padding: 0 1.1rem;
      }

      footer {
        flex-direction: column;
      }
    }

    /* ================== GENERIC CARDS / GRID (same style) ================== */

    .section {
      margin-bottom: 2.75rem;
    }

    .section-header {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 0.75rem;
      margin-bottom: 1.25rem;
    }

    .section-kicker {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.22em;
      color: var(--text-soft);
      margin-bottom: 0.25rem;
    }

    .section-title {
      font-size: 1.35rem;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: var(--text-main);
    }

    .section-subtitle {
      font-size: 0.85rem;
      color: var(--text-muted);
      max-width: 360px;
    }

    .card-grid {
      display: grid;
      grid-template-columns: minmax(0, 3fr) minmax(0, 2.5fr);
      gap: 1.75rem;
    }

    .card {
      border-radius: var(--radius-lg);
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      padding: 1.5rem 1.35rem;
      box-shadow: var(--shadow-strong);
      transition:
        transform var(--transition-med),
        box-shadow var(--transition-med),
        border-color var(--transition-med),
        background var(--transition-med);
    }

    .card:hover {
      transform: translateY(-4px);
      box-shadow: 0 0 26px rgba(0, 255, 200, 0.35);
      border-color: var(--accent-soft);
    }

    .card-title {
      font-size: 1rem;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      margin-bottom: 0.65rem;
      color: var(--text-main);
    }

    .card-text {
      font-size: 0.96rem;
      color: var(--text-muted);
      line-height: 1.7;
      margin-bottom: 0.6rem;
    }

    @media (max-width: 880px) {
      .card-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    /* ================== PRAYER PAGE SPECIFIC ================== */

    .prayer-layout-note {
      font-size: 0.9rem;
      color: var(--text-muted);
      margin-bottom: 1rem;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 0.85rem 1rem;
      margin-top: 0.5rem;
    }

    .form-grid-full {
      grid-column: 1 / -1;
    }

    @media (max-width: 640px) {
      .form-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .field-label {
      display: block;
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.13em;
      color: var(--text-soft);
      margin-bottom: 0.3rem;
    }

    .field-label .optional {
      font-size: 0.72rem;
      opacity: 0.7;
      text-transform: none;
      letter-spacing: normal;
    }

    .input,
    .textarea {
      width: 100%;
      border-radius: 12px;
      border: 1px solid var(--border-subtle);
      background: var(--bg-elevated);
      color: var(--text-main);
      padding: 0.55rem 0.8rem;
      font-size: 0.9rem;
      outline: none;
      resize: vertical;
      min-height: 2.4rem;
      transition:
        border-color var(--transition-fast),
        box-shadow var(--transition-fast),
        background var(--transition-fast),
        transform var(--transition-fast);
    }

    .textarea {
      min-height: 6rem;
      line-height: 1.5;
      border-radius: 14px;
    }

    :root[data-theme="light"] .input,
    :root[data-theme="light"] .textarea {
      background: #ffffff;
    }

    .input:focus,
    .textarea:focus {
      border-color: var(--accent-soft);
      box-shadow: 0 0 10px rgba(0, 255, 200, 0.3);
      transform: translateY(-1px);
    }

    .actions-row {
      display: flex;
      justify-content: flex-end;
      margin-top: 0.8rem;
      gap: 0.75rem;
      flex-wrap: wrap;
    }

    .btn {
      position: relative;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.45rem;
      padding: 0.7rem 1.6rem;
      border-radius: var(--radius-full);
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      border: 1px solid var(--border-subtle);
      cursor: pointer;
      text-decoration: none;
      transition:
        transform var(--transition-fast),
        box-shadow var(--transition-fast),
        background var(--transition-fast),
        border-color var(--transition-fast),
        color var(--transition-fast);
    }

    .btn-primary {
      background: radial-gradient(circle at 0 0, var(--accent), var(--accent-alt));
      color: #020409;
      box-shadow: var(--shadow-accent);
      border-color: transparent;
    }

    .btn-outline {
      background: var(--bg-elevated);
      color: var(--text-main);
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 0 22px rgba(0, 255, 200, 0.4);
    }

    .btn:active {
      transform: translateY(0);
      box-shadow: 0 0 10px rgba(0, 255, 200, 0.3);
    }

    .btn span.icon {
      font-size: 1rem;
    }

    .count-label {
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    .prayer-list {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      margin-top: 0.75rem;
    }

    /* Hologram-styled cards integrated with Forge colors */
    .prayer-card {
      position: relative;
      border-radius: var(--radius-lg);
      padding: 0.7rem 0.85rem 0.7rem;
      cursor: pointer;
      overflow: hidden;
      transform: translateY(0) translateZ(0);
      transition:
        transform var(--transition-fast),
        box-shadow var(--transition-fast),
        border-color var(--transition-fast),
        background-color var(--transition-fast);
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.85);
      backdrop-filter: blur(16px);
    }

    .prayer-card::before {
      content: "";
      position: absolute;
      inset: -120%;
      background:
        conic-gradient(
          from 0deg,
          rgba(0, 255, 200, 0.25),
          rgba(0, 140, 255, 0.4),
          rgba(0, 255, 200, 0.25)
        );
      opacity: 0;
      transition: opacity var(--transition-med);
      mix-blend-mode: screen;
      pointer-events: none;
    }

    .prayer-card::after {
      content: "";
      position: absolute;
      inset: 1px;
      border-radius: calc(var(--radius-lg) - 1px);
      border: 1px solid rgba(0, 0, 0, 0.65);
      opacity: 0.8;
      pointer-events: none;
    }

    .prayer-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 22px 55px rgba(0, 0, 0, 0.95);
      border-color: var(--accent-soft);
    }

    .prayer-card:hover::before {
      opacity: 0.5;
    }

    .prayer-card.open {
      animation: glowPulse 1.6s infinite alternate ease-in-out;
    }

    @keyframes glowPulse {
      from {
        box-shadow:
          0 0 0 1px rgba(0, 255, 200, 0.5),
          0 0 25px rgba(0, 255, 200, 0.7),
          0 18px 45px rgba(0, 0, 0, 0.95);
      }
      to {
        box-shadow:
          0 0 0 1px rgba(0, 140, 255, 0.65),
          0 0 40px rgba(0, 140, 255, 0.85),
          0 24px 65px rgba(0, 0, 0, 1);
      }
    }

    .prayer-header {
      display: flex;
      align-items: center;
      gap: 0.6rem;
    }

    .chevron {
      width: 18px;
      height: 18px;
      border-radius: 999px;
      border: 1px solid rgba(0, 255, 200, 0.75);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      font-size: 0.65rem;
      color: var(--text-main);
      transition:
        transform var(--transition-med),
        background-color var(--transition-med),
        border-color var(--transition-med),
        color var(--transition-med);
      background: radial-gradient(circle at 30% 20%, rgba(0, 140, 255, 0.9), #020409);
      box-shadow: 0 0 10px rgba(0, 140, 255, 0.9);
    }

    .prayer-card.open .chevron {
      transform: rotate(90deg);
      background: radial-gradient(circle at 30% 20%, rgba(0, 255, 200, 0.95), #022c22);
      border-color: rgba(0, 255, 200, 1);
      box-shadow: 0 0 16px rgba(0, 255, 200, 1);
      color: #ecfeff;
    }

    .chevron-icon {
      display: inline-block;
      transform: translateX(1px);
    }

    .prayer-main {
      flex: 1;
      min-width: 0;
    }

    .prayer-title {
      font-size: 0.93rem;
      font-weight: 600;
      margin-bottom: 2px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      color: var(--text-main);
    }

    .prayer-meta {
      font-size: 0.78rem;
      color: var(--text-soft);
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
    }

    .meta-pill {
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 255, 0.5);
      background: var(--bg-card-soft);
      font-size: 0.75rem;
    }

    .prayer-body {
      margin-top: 0.4rem;
      font-size: 0.86rem;
      line-height: 1.5;
      color: var(--text-muted);
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.35s ease;
    }

    .prayer-body-inner {
      padding-top: 0.35rem;
      border-top: 1px dashed rgba(148, 163, 255, 0.4);
    }

    .prayer-body p {
      margin: 0;
      white-space: pre-wrap;
    }

    .hint-line {
      font-size: 0.72rem;
      color: var(--text-soft);
      margin-top: 0.35rem;
    }

    .status-line {
      font-size: 0.8rem;
      color: var(--text-soft);
      margin-top: 0.5rem;
    }
  </style>
</head>
<body>
  <div class="ambient-orbit"></div>

  <header>
    <nav class="nav">
      <div class="brand">
        <img src="images/theforgelogo.png" alt="The Forge logo" class="brand-logo" />
        <div>
          <div class="brand-text-main">The Forge</div>
        </div>
      </div>

      <div class="nav-links">
        <a href="theforge.html#overview">Overview</a>
        <a href="theforge.html#why">Why</a>
        <a href="theforge.html#beliefs">Beliefs</a>
        <a href="theforge.html#rules">Rules</a>
        <a href="theforge.html#join">Join</a>
        <a href="theforge.html#contact">Contact</a>
        <a href="prayerrequests.html" class="active">Prayer Requests</a>
      </div>

      <div class="nav-actions">
        <button class="theme-toggle" id="themeToggle" type="button">
          <span class="icon">üåô</span>
          <span>Theme</span>
        </button>
        <button class="hamburger" id="hamburger" type="button" aria-label="Toggle navigation" aria-expanded="false">
          <span class="hamburger-line"></span>
          <span class="hamburger-line"></span>
          <span class="hamburger-line"></span>
        </button>
      </div>
    </nav>

    <!-- Mobile nav overlay -->
    <div class="mobile-nav" id="mobileNav">
      <div class="mobile-nav-inner">
        <a href="theforge.html#overview">Overview</a>
        <a href="theforge.html#why">Why</a>
        <a href="theforge.html#beliefs">Beliefs</a>
        <a href="theforge.html#rules">Rules</a>
        <a href="theforge.html#join">Join</a>
        <a href="theforge.html#contact">Contact</a>
        <a href="prayerrequests.html">Prayer Requests</a>
      </div>
    </div>
  </header>

  <main class="shell">
    <section class="section" id="prayers">
      <div class="section-header">
        <div>
          <div class="section-kicker">Community</div>
          <h1 class="section-title">Prayer Requests</h1>
        </div>
        <p class="section-subtitle">
          Submit requests for the brothers to pray over and see the most recent prayers in the feed.
        </p>
      </div>

      <p class="prayer-layout-note">
        Requests show the title, time posted, and your name if you choose to share it. Details are revealed when a card is opened.
      </p>

      <div class="card-grid">
        <!-- Left: form / info -->
        <article class="card">
          <h2 class="card-title">Submit a Request</h2>
          <p class="card-text">
            Share as much or as little detail as you‚Äôre comfortable with. You can post under your name or anonymously.
          </p>

          <!-- Later: we can update this line to show auth status (signed in / not) from auth.js -->
          <div class="status-line" id="authStatus">
            <!-- Placeholder; auth.js will replace this later -->
            Prayer feed currently does not require sign-in. We‚Äôll lock this down with invite-only access next.
          </div>

          <form id="prayerForm" autocomplete="off" novalidate>
            <div class="form-grid">
              <div>
                <label for="name" class="field-label">
                  Name <span class="optional">(optional)</span>
                </label>
                <input
                  type="text"
                  id="name"
                  name="name"
                  maxlength="80"
                  class="input"
                  placeholder="Leave blank to post as Anonymous"
                />
              </div>

              <div>
                <label for="title" class="field-label">
                  Request Title <span class="optional">(required)</span>
                </label>
                <input
                  type="text"
                  id="title"
                  name="title"
                  maxlength="120"
                  class="input"
                  placeholder="Prayer request summary"
                  required
                />
              </div>

              <div class="form-grid-full">
                <label for="message" class="field-label">
                  Prayer Request Details <span class="optional">(required)</span>
                </label>
                <textarea
                  id="message"
                  name="message"
                  maxlength="3000"
                  class="textarea"
                  placeholder="Share details here so we can pray specifically."
                  required
                ></textarea>
              </div>
            </div>

            <div class="actions-row">
              <button type="submit" class="btn btn-primary">
                <span class="icon">üôè</span>
                <span>Submit Request</span>
              </button>
            </div>
          </form>
        </article>

        <!-- Right: feed -->
        <article class="card">
          <div style="display:flex;align-items:center;justify-content:space-between;gap:0.75rem;">
            <h2 class="card-title" style="margin-bottom:0;">Prayer Feed</h2>
            <span id="requestCountLabel" class="count-label">Loading‚Ä¶</span>
          </div>

          <div class="prayer-list" id="prayerList">
            <!-- Cards injected via JS -->
          </div>
        </article>
      </div>
    </section>

    <footer>
      <div>¬© <span id="year"></span> The Forge ¬∑ ESTD 2025</div>
      <div>Built for men who fear God, love truth, and refuse to walk alone.</div>
    </footer>
  </main>

  <!-- THEME + NAV SCRIPTS (same behavior as theforge.html) -->
  <script>
    // THEME TOGGLE (shared with theforge.html)
    (function () {
      const root = document.documentElement;
      const toggle = document.getElementById('themeToggle');
      const stored = localStorage.getItem('forge-theme');

      if (stored === 'light' || stored === 'dark') {
        root.setAttribute('data-theme', stored);
      } else {
        root.setAttribute('data-theme', 'dark');
      }

      function updateIcon() {
        const theme = root.getAttribute('data-theme');
        const iconSpan = toggle.querySelector('.icon');
        if (theme === 'light') {
          iconSpan.textContent = '‚òÄÔ∏è';
        } else {
          iconSpan.textContent = 'üåô';
        }
      }

      updateIcon();

      toggle.addEventListener('click', () => {
        const current = root.getAttribute('data-theme') || 'dark';
        const next = current === 'dark' ? 'light' : 'dark';
        root.setAttribute('data-theme', next);
        localStorage.setItem('forge-theme', next);
        updateIcon();
      });
    })();

    // MOBILE NAV TOGGLE
    (function () {
      const hamburger = document.getElementById('hamburger');
      const mobileNav = document.getElementById('mobileNav');

      if (!hamburger || !mobileNav) return;

      function closeNav() {
        mobileNav.classList.remove('open');
        hamburger.classList.remove('is-open');
        hamburger.setAttribute('aria-expanded', 'false');
      }

      function openNav() {
        mobileNav.classList.add('open');
        hamburger.classList.add('is-open');
        hamburger.setAttribute('aria-expanded', 'true');
      }

      hamburger.addEventListener('click', () => {
        if (mobileNav.classList.contains('open')) {
          closeNav();
        } else {
          openNav();
        }
      });

      mobileNav.querySelectorAll('a').forEach((link) => {
        link.addEventListener('click', () => {
          closeNav();
        });
      });
    })();

    // YEAR IN FOOTER
    document.getElementById('year').textContent = new Date().getFullYear();
  </script>

  <!-- FIREBASE + FIRESTORE (MODULE) -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js";
    import {
      getFirestore,
      collection,
      addDoc,
      serverTimestamp,
      query,
      orderBy,
      onSnapshot
    } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js";

    // TODO: paste your real config here from the "theforge" Firebase project
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY_HERE",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT_ID.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const prayerListEl = document.getElementById("prayerList");
    const countLabelEl = document.getElementById("requestCountLabel");
    const formEl = document.getElementById("prayerForm");
    const authStatusEl = document.getElementById("authStatus");

    function sanitizeName(name) {
      const trimmed = (name || "").trim();
      if (!trimmed) return "Anonymous";
      return trimmed;
    }

    function formatDateTime(date) {
      const options = {
        year: "numeric",
        month: "short",
        day: "2-digit",
        hour: "numeric",
        minute: "2-digit"
      };
      return date.toLocaleString(undefined, options);
    }

    function updateCountLabel(count) {
      if (count === 0) {
        countLabelEl.textContent = "No active requests yet";
      } else if (count === 1) {
        countLabelEl.textContent = "1 active request";
      } else {
        countLabelEl.textContent = count + " active requests";
      }
    }

    function createPrayerCard(prayer) {
      const card = document.createElement("article");
      card.className = "prayer-card";
      card.setAttribute("tabindex", "0");
      card.dataset.id = prayer.id;

      const safeName = sanitizeName(prayer.name);
      const dateText = formatDateTime(prayer.createdAt || new Date());

      card.innerHTML = `
        <div class="prayer-header">
          <div class="chevron" aria-hidden="true">
            <span class="chevron-icon">‚ñ∂</span>
          </div>
          <div class="prayer-main">
            <div class="prayer-title">${prayer.title || "Untitled request"}</div>
            <div class="prayer-meta">
              <span class="meta-pill">${dateText}</span>
              <span class="meta-pill">Requested by: ${safeName}</span>
            </div>
          </div>
        </div>
        <div class="prayer-body">
          <div class="prayer-body-inner">
            <p>${(prayer.message || "").replace(/\n/g, "<br>")}</p>
            <div class="hint-line">Tap card again to collapse</div>
          </div>
        </div>
      `;

      const bodyEl = card.querySelector(".prayer-body");

      function toggleOpen() {
        const isOpen = card.classList.contains("open");
        if (isOpen) {
          const currentHeight = bodyEl.scrollHeight;
          bodyEl.style.maxHeight = currentHeight + "px";
          requestAnimationFrame(() => {
            bodyEl.style.maxHeight = "0px";
          });
          card.classList.remove("open");
        } else {
          // Close others
          document.querySelectorAll(".prayer-card.open").forEach(openCard => {
            if (openCard !== card) {
              const openBody = openCard.querySelector(".prayer-body");
              const h = openBody.scrollHeight;
              openBody.style.maxHeight = h + "px";
              requestAnimationFrame(() => {
                openBody.style.maxHeight = "0px";
              });
              openCard.classList.remove("open");
            }
          });

          const fullHeight = bodyEl.scrollHeight;
          bodyEl.style.maxHeight = fullHeight + "px";
          card.classList.add("open");
        }
      }

      card.addEventListener("click", toggleOpen);
      card.addEventListener("keydown", (e) => {
        if (e.key === "Enter" || e.key === " ") {
          e.preventDefault();
          toggleOpen();
        }
      });

      bodyEl.style.maxHeight = "0px";
      return card;
    }

    function renderPrayersFromSnapshot(snapshot) {
      const prayers = [];
      snapshot.forEach(docSnap => {
        const data = docSnap.data();
        let createdAtDate = new Date();
        if (data.createdAt && typeof data.createdAt.toDate === "function") {
          createdAtDate = data.createdAt.toDate();
        }
        prayers.push({
          id: docSnap.id,
          title: data.title || "",
          name: data.name || "",
          message: data.message || "",
          createdAt: createdAtDate
        });
      });

      prayerListEl.innerHTML = "";
      prayers.forEach(prayer => {
        const card = createPrayerCard(prayer);
        prayerListEl.appendChild(card);
      });
      updateCountLabel(prayers.length);
    }

    // Real-time listener (newest first)
    const prayersRef = collection(db, "prayerRequests");
    const prayersQuery = query(prayersRef, orderBy("createdAt", "desc"));

    onSnapshot(
      prayersQuery,
      (snapshot) => {
        renderPrayersFromSnapshot(snapshot);
      },
      (error) => {
        console.error("Error fetching prayer requests:", error);
        countLabelEl.textContent = "Error loading requests";
      }
    );

    // FORM HANDLING
    formEl.addEventListener("submit", async (event) => {
      event.preventDefault();

      const nameInput = document.getElementById("name");
      const titleInput = document.getElementById("title");
      const messageInput = document.getElementById("message");

      const title = titleInput.value.trim();
      const message = messageInput.value.trim();
      const name = nameInput.value;

      if (!title || !message) {
        alert("Please fill in both the title and the details of your prayer request.");
        return;
      }

      try {
        await addDoc(prayersRef, {
          title,
          message,
          name,
          createdAt: serverTimestamp()
        });

        titleInput.value = "";
        messageInput.value = "";
        // Optional: keep name in the field so frequent posters don't have to retype.
      } catch (err) {
        console.error("Error adding prayer:", err);
        alert("There was an error submitting your request. Please try again.");
      }
    });

    // ===== Auth hooks placeholder =====
    // Later, when we create auth.js, it can expose a global like `window.forgeAuth`
    // with onAuthStateChanged-style callbacks. For now, just note that auth is not wired.
    if (authStatusEl) {
      authStatusEl.textContent =
        "Prayer feed is live. In the next step, this page will be locked behind invite-only accounts.";
    }
  </script>
</body>
</html>
