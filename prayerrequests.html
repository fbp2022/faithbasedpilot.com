<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>The Forge ¬∑ Prayer Requests</title>
  <meta name="color-scheme" content="dark light" />
  <meta
    name="description"
    content="Private prayer wall for men in The Forge to share prayer needs and stand in the gap for one another."
  />

  <!-- Shared site styles -->
  <!-- If your CSS file name/path differs, update this line only. -->
  <link rel="stylesheet" href="./styling.css?v=1">

  <!-- Optional: apply saved theme ASAP to avoid flash -->
  <script>
    (function () {
      try {
        const saved = localStorage.getItem("forge_theme");
        if (saved === "light" || saved === "dark") {
          document.documentElement.setAttribute("data-theme", saved);
        }
      } catch {}
    })();
  </script>
</head>

<body>
  <div class="ambient-orbit"></div>

  <header>
    <nav class="nav">
      <div class="brand">
        <img src="images/theforgelogo.png" alt="The Forge logo" class="brand-logo" />
        <div>
          <div class="brand-text-main">The Forge</div>
          <div class="brand-text-sub">Prayer Requests</div>
        </div>
      </div>

      <div class="nav-links">
        <a href="theforge.html">Overview</a>
        <a href="members.html">Members</a>
        <a href="prayerrequests.html" class="active">Prayer Requests</a>
      </div>

      <div class="nav-actions">
        <!-- Desktop theme toggle (theme.js expects these IDs) -->
        <button
          id="themeToggleDesktop"
          class="theme-toggle-btn"
          type="button"
          aria-label="Toggle light/dark theme"
          title="Toggle theme"
        >
          <span class="theme-icon theme-icon-moon">üåô</span>
          <span class="theme-icon theme-icon-sun">‚òÄÔ∏è</span>
        </button>

        <button id="accountButton" class="account-btn" type="button">
          <span class="icon">üë§</span>
          <span id="navAuthButtonLabel">Sign In</span>
        </button>

        <button
          class="hamburger"
          id="hamburger"
          type="button"
          aria-label="Toggle navigation"
          aria-expanded="false"
          aria-controls="mobileNav"
        >
          <span class="hamburger-line"></span>
          <span class="hamburger-line"></span>
          <span class="hamburger-line"></span>
        </button>
      </div>
    </nav>

    <!-- Mobile nav overlay -->
    <div class="mobile-nav" id="mobileNav" aria-hidden="true">
      <div class="mobile-nav-inner">
        <a href="theforge.html">Overview</a>
        <a href="members.html">Members</a>
        <a href="prayerrequests.html" class="active">Prayer Requests</a>

        <!-- Mobile theme toggle -->
        <button class="mobile-theme-toggle" id="themeToggleMobile" type="button">
          <span class="mobile-theme-label">Toggle theme</span>
          <span class="mobile-theme-icon" id="mobileThemeIcon">üåô</span>
        </button>

        <div class="mobile-account-meta">
          <span id="navMobileUserLabel">Guest</span>
        </div>

        <button class="mobile-account-btn" id="mobileAccountButton" type="button">
          <span id="navMobileAuthButtonLabel">Sign In / Create</span>
        </button>
      </div>
    </div>
  </header>

  <main class="shell">
    <section aria-labelledby="page-title">
      <div class="page-header-kicker">Pray for one another</div>
      <h1 id="page-title" class="page-title">Share a prayer need, stand in the gap.</h1>
      <p class="page-intro">
        This is a private wall for men in The Forge to ask for prayer and commit to praying
        for one another. Be honest, be specific, and remember that what you share here is
        treated with care.
      </p>

      <div class="top-grid">
        <!-- LEFT: POST A REQUEST -->
        <article class="card">
          <div class="card-inner">
            <div class="card-kicker">Share a prayer need</div>
            <h2 class="card-title-main">Post a request</h2>

            <form id="prayerForm" class="prayer-form" autocomplete="off">
              <!-- 1) Display name -->
              <div class="field-group" data-field="name">
                <input
                  id="name"
                  name="name"
                  type="text"
                  class="field-control"
                  placeholder="Display name (optional)"
                  maxlength="80"
                />
                <label for="name" class="field-label">Display name (optional)</label>
              </div>

              <!-- 2) Request title -->
              <div class="field-group" data-field="title">
                <input
                  id="title"
                  name="title"
                  type="text"
                  class="field-control"
                  placeholder="Title of your request"
                  maxlength="120"
                  required
                />
                <label for="title" class="field-label">Prayer request title</label>
              </div>

              <!-- 3) Request body -->
              <div class="field-group textarea" data-field="message">
                <textarea
                  id="message"
                  name="message"
                  class="field-control"
                  placeholder="Share what you're asking God to do"
                  required
                ></textarea>
                <label for="message" class="field-label">Prayer request details</label>
              </div>

              <p class="field-note">
                Requests are timestamped and a Discord notification will be posted for members.
              </p>

              <div class="form-actions">
                <button type="submit" class="btn btn-primary">
                  <span class="icon">üì®</span>
                  <span>Submit Request</span>
                </button>
                <button type="reset" class="btn btn-outline">
                  <span>Clear</span>
                </button>
              </div>

              <div id="newPrayerError" class="form-error"></div>
            </form>
          </div>
        </article>

        <!-- RIGHT: HOW THIS WORKS -->
        <article class="card">
          <div class="card-inner">
            <div class="card-kicker">Heart of The Forge</div>
            <h2 class="card-title-main">How this works</h2>
            <div class="card-text">
              <p>
                Every request on this wall represents a real man walking through real battles.
                When you open a request and tap <strong>‚ÄúI‚Äôm praying‚Äù</strong>, the counter
                will reflect that you‚Äôve committed to pray for your brother in Christ.
              </p>
              <ul style="margin: 0.8rem 0 0.6rem 1.1rem; padding-left: 0;">
                <li>
                  Each brother can mark ‚ÄúI‚Äôm praying‚Äù <strong>one time per request.</strong>
                </li>
                <li>
                  When you open another request, the previous one will collapse to keep the
                  wall clean.
                </li>
                <li>
                  You may use specific details if you'd like, but avoid sharing anything that
                  would betray another person‚Äôs trust.
                </li>
              </ul>
              <p style="margin-top: 0.7rem;">
                <em>
                  ‚ÄúConfess your sins to one another and pray for one another, that you may be
                  healed.‚Äù ‚Äî James 5:16
                </em>
              </p>
            </div>
          </div>
        </article>
      </div>
    </section>

    <!-- PRAYER WALL -->
    <section aria-labelledby="wall-title">
      <article class="card wall-card">
        <div class="card-inner">
          <div class="card-kicker">Prayer Wall</div>
          <h2 id="wall-title" class="card-title-main">Pray for one another</h2>
          <p class="wall-subtext">
            Below are active requests from men in The Forge. Click a request to expand the
            details, then tap ‚ÄúI‚Äôm praying‚Äù to let your brother in Christ know you're
            praying for them.
          </p>

          <div class="request-count" id="requestCountLabel">
            Sign in to view prayer requests.
          </div>

          <div id="prayerList" class="prayer-list">
            <!-- Populated by auth.js / Firestore -->
          </div>
        </div>
      </article>
    </section>

    <!-- ACCESSIBILITY NOTE (Footer Position) -->
    <section class="accessibility-note-footer" aria-label="Accessibility information">
      <p>
        <strong>Accessibility:</strong>
        The Forge website is designed to follow
        <strong>WCAG 2.1 AA</strong> standards for contrast, keyboard navigation,
        screen-reader structure, and reduced-motion support.
        If you experience difficulty accessing any part of this site or The Forge Discord,
        please email
        <a href="mailto:theforgetncommunity@gmail.com">theforgetncommunity@gmail.com</a>
        and we will work with you to provide alternative access or assistance.
      </p>
    </section>

    <footer>
      <div>¬© <span id="year"></span> The Forge ¬∑ Prayer Requests</div>
      <div class="auth-status-text" id="authStatus">Not signed in</div>
    </footer>
  </main>

  <!-- AUTH MODAL -->
  <div
    class="auth-overlay"
    id="authOverlay"
    aria-modal="true"
    role="dialog"
    aria-hidden="true"
  >
    <div class="auth-card">
      <button
        type="button"
        class="auth-close-btn"
        id="authCloseBtn"
        aria-label="Close account window"
      >
        ‚úï
      </button>

      <div class="auth-card-inner">
        <div class="auth-card-header">
          <div class="auth-card-title">Forge Account</div>
          <div class="auth-card-sub">
            Invite-only access. Use the code you were given by the group owner.
          </div>
        </div>

        <div class="auth-toggle-row">
          <button
            type="button"
            class="auth-toggle-btn active"
            data-mode="signin"
          >
            Sign In
          </button>
          <button
            type="button"
            class="auth-toggle-btn"
            data-mode="signup"
          >
            Create Account
          </button>
        </div>

        <!-- Sign In -->
        <form id="loginForm" class="auth-form" autocomplete="on">
          <div class="auth-field">
            <label class="auth-label" for="loginEmail">Email</label>
            <input
              id="loginEmail"
              type="email"
              class="auth-input"
              autocomplete="email"
              required
            />
          </div>
          <div class="auth-field">
            <label class="auth-label" for="loginPassword">Password</label>
            <input
              id="loginPassword"
              type="password"
              class="auth-input"
              autocomplete="current-password"
              required
            />
          </div>

          <!-- IMPORTANT: auth.js expects this ID -->
          <a href="#" id="forgotPasswordLink" class="forgot-password-link">Forgot password?</a>

          <button type="submit" class="auth-btn">Sign In</button>
          <div class="auth-error" id="authErrorLogin"></div>

          <div class="auth-footnote">
            Already joined? Use the email and password you created.
          </div>
        </form>

        <!-- Sign Up -->
        <form
          id="signupForm"
          class="auth-form"
          style="display:none;"
          autocomplete="on"
        >
          <div class="auth-field">
            <label class="auth-label" for="signupFirstName">First Name</label>
            <input
              id="signupFirstName"
              type="text"
              class="auth-input"
              autocomplete="given-name"
              required
            />
          </div>
          <div class="auth-field">
            <label class="auth-label" for="signupLastName">Last Name</label>
            <input
              id="signupLastName"
              type="text"
              class="auth-input"
              autocomplete="family-name"
              required
            />
          </div>

          <!-- Optional legacy display name field (auth.js reads this if present) -->
          <input id="signupName" type="hidden" />

          <div class="auth-field">
            <label class="auth-label" for="signupEmail">Email</label>
            <input
              id="signupEmail"
              type="email"
              class="auth-input"
              autocomplete="email"
              required
            />
          </div>
          <div class="auth-field">
            <label class="auth-label" for="signupPassword">Password</label>
            <input
              id="signupPassword"
              type="password"
              class="auth-input"
              autocomplete="new-password"
              required
            />
          </div>
          <div class="auth-field">
            <label class="auth-label" for="signupPassword2">Confirm Password</label>
            <input
              id="signupPassword2"
              type="password"
              class="auth-input"
              autocomplete="new-password"
              required
            />
          </div>
          <div class="auth-field">
            <label class="auth-label" for="signupInvite">Invite Code</label>
            <input
              id="signupInvite"
              type="text"
              class="auth-input"
              placeholder="Enter your invite code"
              required
            />
          </div>

          <button type="submit" class="auth-btn">Create Account</button>
          <div class="auth-error" id="authErrorSignup"></div>

          <div class="auth-footnote">
            Accounts are invite-only. If you don‚Äôt have a code, ask the group owner.
          </div>
        </form>

        <!-- Sign Out (auth.js toggles display) -->
        <button
          type="button"
          id="signOutButton"
          class="auth-btn"
          style="margin-top: 0.75rem; display: none;"
        >
          Sign Out
        </button>
      </div>
    </div>
  </div>

  <!-- Footer year -->
  <script>
    document.getElementById("year").textContent = new Date().getFullYear();
  </script>

  <!-- Shared behavior -->
  <script src="theme.js"></script>
  <script src="mobile-nav.js"></script>
  <script src="a11y.js"></script>

  <!-- Firebase wiring & logic -->
  <script type="module" src="auth.js"></script>
</body>
</html>
